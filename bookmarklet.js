javascript:!function(){var e;if((e=new XMLHttpRequest).open("GET","https://raw.githubusercontent.com/Vazkii/hensei-transfer/main/version",!1),e.send(),1!=e.response.trim()&&confirm("hensei-transfer has received an update. Please re-download the bookmarklet to ensure it's compatible with the latest granblue.team changes, or click Cancel to proceed anyway.")){window.open("https://github.com/Vazkii/hensei-transfer","_blank");return}window.location.href.includes("app.granblue.team")?function e(){function n(e,n,t,o){var _=0;for(k in t){var u=t[k],l=u.name,c=u.id,p=u.uncap,d=r(e,"summons",{query:l},function(e){return e.granblue_id==c});if(d.length>0){var f=0==o&&0==_,m=_-1+o,v=a(e,"summons",m,{summon:{summon_id:d,party_id:e.party,position:m,main:f,friend:!1,uncap_level:p}}).grid_summon.id;"transcend"in u&&s(e,"grid_summons",v,"",{summon:{uncap_level:6,transcendence_step:u.transcend}},!0),_++}}if(n){var d=r(e,"summons",{query:n},function(a){return a.name[e.lang]==n});d.length>0&&a(e,"summons",m,{summon:{summon_id:d,party_id:e.party,position:6,main:!1,friend:!0}})}}function a(e,n,a,r){var t=_(e,n,r);return"conflicts"in t&&(t=_(e,`${n}/resolve`,{resolve:{conflicting:[t.conflicts[0].id],incoming:t.incoming.id,position:a}})),t}function r(e,n,a,r){return t(_(e,`search/${n}`,{search:a}).results,r)}function t(e,n){for(k in e){var a=e[k];if(n(a))return a.id}return null==e||void 0==e||0==e.length?"":e[0].id}function o(e,n){return u(e,"GET",n,void 0,!1)}function s(e,n,a,r,t,o){return u(e,"PUT",`${n}/${a}/${r}`,t,o)}function _(e,n,a){return u(e,"POST",n,a,!1)}function u(e,n,a,r,t){var o=new XMLHttpRequest,s=`https://hensei-api-production-66fb.up.railway.app/api/v1/${a}`;return(o.open(n,s,t),o.setRequestHeader("content-type","application/json"),o.setRequestHeader("authorization",`Bearer ${e.auth}`),void 0!=r?o.send(JSON.stringify(r)):o.send(),t)?"":JSON.parse(o.responseText)}!function e(u){var l=u.props.pageProps.context;if(null==l){alert("Please refresh the page to load important data, then try again.");return}if(void 0==l.jobs||null==l.jobs){alert("Some data needed to create a team is missing, please open a team that already exists and press F5, and then run the script again. This will not overwrite your team. You can offset this by bookmarking the New team page and running the script from there.");return}var c=function e(){var n=document.cookie.match(RegExp("token\u002522\u00253A\u002522(.+?)\u002522"));if(n)return n[1]}();if(!c){alert("This import script only works for logged-in users, please log-in or create an account.");return}var p={jobs:l.jobs,auth:c},d=prompt("Paste your Export here");if(d&&0!=d.length){var f=JSON.parse(d);document.querySelectorAll("*").forEach(e=>e.style.cursor="wait");var m=document.querySelector('span[class^="Button_text__"]');m&&(m.innerHTML='<span style="color:cyan;font-size:22px;">Loading your team... this may take a bit</span>'),setTimeout(function(){var e,u,l,c,d,m,v=(e=p,u=_(e,"parties",{}),{id:u.party.id,redirect:`/p/${u.party.shortcode}`});p.party=v.id,p.lang=f.lang,c=p,d=f.name,m=f.extra,s(c,"parties",c.party,"",{party:{name:d,extra:m}},!0),function e(n,a,_,u){var l=t(n.jobs,function(e){return e.name[n.lang]==a});if(l.length>0){if(s(n,"parties",n.party,"jobs",{party:{job_id:l}},!1),_.length>0){var c={},p=0;for(k in _){var d=_[k],f=r(n,"job_skills",{query:d,job:l,locale:n.lang},function(e){return e.name[n.lang]==d});f.length>0&&(c[`skill${++p}_id`]=f)}var m=[];for(k in c){var v={};v[k]=c[k],"code"in s(n,"parties",n.party,"job_skills",{party:v},!1)&&m.push(v)}for(k in m)s(n,"parties",n.party,"job_skills",{party:m[k]},!0)}if(u){var g=o(n,`jobs/${l}/accessories`),h=t(g,function(e){return e.granblue_id==u});s(n,"parties",n.party,"",{party:{accessory_id:h}})}}}(p,f.class,f.subskills,"accessory"in f?f.accessory:""),function e(n,t){var o=0;for(k in t){var _=t[k],u=_.name,l=_.id,c=_.uncap,p=r(n,"characters",{query:u},function(e){return e.granblue_id==l});if(p.length>0){var d=a(n,"characters",o,{character:{character_id:p,party_id:n.party,position:o,uncap_level:c}}).id;"ringed"in _&&_.ringed&&s(n,"grid_characters",d,"",{character:{perpetuity:!0}},!0),"transcend"in _&&s(n,"grid_characters",d,"",{character:{uncap_level:6,transcendence_step:_.transcend}},!0),o++}}}(p,f.characters),function e(n,_){let u=[0,2,3,4,1,6,5],l={k13001:"1240",k13002:"1241",k13003:"1242",k13004:"1243",k14014:"1723",k14015:"1724",k14016:"1725",k14017:"1726",k10001:"697-706",k10002:"707-716",k10003:"717-726",k10004:"727-736",k10005:"737-746",k10006:"747-756",k11001:"758",k11002:"759",k11003:"760",k11004:"761",k17001:"1807",k17002:"1808",k17003:"1809",k17004:"1810",k15001:"1446",k15002:"1447",k15003:"1448",k15004:"1449",k15005:"1450",k15006:"1451",k15007:"1452",k16001:"1228-1233",k16002:"1234-1239",k14001:["502-506","1213-1218"],k14002:["130-135","71-76"],k14003:["1260-1265","1266-1271"],k14004:["1199-1204","1205-1210"],k14011:["322-327","1310-1315"],k14012:["764-769","1731-1735","948"],k14013:["1171-1176","1736-1741"]},c=["1589","1590","1588","1591","1592","1596","1597","1588","1599","1593","1595","1601","1600","1594","1722","1719","1720","1721","1837","1838"];var p=0;for(k in _){var d=_[k],f=d.name,m=d.id,v=d.uncap,g=r(n,"weapons",{query:f},function(e){return e.granblue_id==m});if(g.length>0){var h=0==p,y=p-1,b=a(n,"weapons",y,{weapon:{weapon_id:g,party_id:n.party,position:y,mainhand:h,uncap_level:v}}),w=b.grid_weapon.id;if("attr"in d&&s(n,"grid_weapons",w,"",{weapon:{element:u[d.attr+1]}},!0),"awakening"in d){for(var x=d.awakening,j=x.type,q=x.lvl,T=b.grid_weapon.object.awakenings,P=null,E=0;E<T.length;E++){var S=T[E];if(S.name[n.lang]==j){P=S;break}}P&&s(n,"grid_weapons",w,"",{weapon:{awakening_id:P.id,awakening_level:q}},!0)}if("keys"in d){var z=d.keys,C=b.grid_weapon.object.series;for(k2 in z){var H=z[k2],A=o(n,`weapon_keys?series=${C}&slot=${k2}`),B=t(A,function(e){var n=`k${e.granblue_id}`;if(n in l){var a=l[n];function r(e){if(e.includes("-")){var n=e.split("-"),a=parseInt(n[0]),r=parseInt(n[1]);return H>=a&&H<=r}return parseInt(e)==H}if("string"==typeof a)return r(a);for(G in a)if(r(a[G]))return!0}return!1}),G=parseInt(k2)+1,I={};I[`weapon_key${G}_id`]=B,s(n,"grid_weapons",w,"",{weapon:I},!0)}}if("ax"in d){var L=d.ax,O={};for(k2 in L){var R=L[k2],V=R.id,D=c.findIndex(e=>e==V),F=parseInt(k2)+1;O[`ax_modifier${F}`]=D,O[`ax_strength${F}`]=R.val}s(n,"grid_weapons",w,"",{weapon:O},!0)}p++}}}(p,f.weapons),n(p,f.friend_summon,f.summons,0),n(p,void 0,f.sub_summons,5);var g=v.redirect;g.length>0&&history.pushState({urlPath:g},"",g),location.reload()},250)}}(__NEXT_DATA__)}():window.location.href.includes("game.granbluefantasy.jp")?function e(){var n,a,r,t,o,s,_,u,l;function c(e){let n=[210,220,230,240];var a=[];for(k in e){var r={},t=e[k],o=t.master,s=t.param;if(o&&s){r.name=o.name,r.id=o.id;var _=parseInt(s.evolution);if(r.uncap=_,_>5){var u=1,l=parseInt(s.level);for(k2 in n)if(l>n[k2])u++;else break;r.transcend=u}a.push(r)}}return a}r=(a=(n=Game).view.deck_model.attributes.deck).name,t=n.lang,o={},s=a.pc,o.lang=t,o.name=r,o.class=s.job.master.name,o.extra=s.isExtraDeck,o.friend_summon=s.damage_info.summon_name,(_=s.familiar_id)||(_=s.shield_id),_&&(o.accessory=_),o.subskills=function e(n){var a=[];for(var r in n){var t=n[r];a.push(t.name)}return a}(s.set_action),o.characters=function e(n){var a=[];for(k in n){var r={},t=n[k],o=t.master,s=t.param;if(o&&s){r.name=o.name,r.id=o.id,r.uncap=parseInt(s.evolution),s.has_npcaugment_constant&&(r.ringed=!0);var _=parseInt(s.phase);_>0&&(r.transcend=_),a.push(r)}}return a}(a.npc),o.weapons=function e(n){let a=[40,60,80,100,150],r=[[13],[3,13,19,27],[3,13,27]],t=[13,17,19];var o=[];for(k in n){var s={},_=n[k],u=_.master,l=_.param;if(u&&l){var c=parseInt(u.series_id);s.name=u.name;var p=u.id;if(t.includes(c)){var d=parseInt(u.attribute)-1;s.attr=d,p=`${parseInt(p)-100*d}`}s.id=p;var f=0,m=parseInt(l.level);for(k2 in a)if(m>a[k2])f++;else break;s.uncap=f;var v=l.arousal;if(v.is_arousal_weapon){var g={};g.type=v.form_name,g.lvl=v.level,s.awakening=g}var h=l.augment_skill_info;if(h.length>0){var y=h[0],b=[];for(k2 in y){var w={},x=y[k2];w.id=`${x.skill_id}`,w.val=x.show_value,b.push(w)}s.ax=b}var j=[];for(i in r)if(r[i].includes(c)){var q=`skill${parseInt(i)+1}`;q in _&&j.push(_[q].id)}j.length>0&&(s.keys=j),o.push(s)}}return o}(s.weapons),o.summons=c(s.summons),o.sub_summons=c(s.sub_summons),u=JSON.stringify(o),l=$("<textarea>"),$("body").append(l),l.text(u),l.select(),document.execCommand("copy"),l.remove(),confirm("Copied team data to clipboard! If you press OK, a new tab in app.granblue.team will be open now - click the bookmark again on it and paste your data in there.")&&window.open("https://app.granblue.team","_blank")}():alert("Can only be used in game.granbluefantasy.jp or app.granblue.team")}();